#! /usr/bin/perl

my $template = join('', <DATA>);

sub stack {
  my ($stackt, $type) = @_;
  my $out = $template;
  $out =~ s/%%S/$stackt/g;
  $out =~ s/%%T/$type/g;
  print $out;
}

print "// Stacks of different types\npackage stacks\n";

stack qw(Stack []byte);
stack qw(StrStack string);

__DATA__

type %%S interface {
  Push(%%T)
  Pop() %%T
  Drop(int) (st []%%T)
  Dump() []%%T
  Depth() int
  Index(p int) %%T
}

type %%ST struct {
  st []%%T
  sp int
  limit bool
}
func (st *%%ST) Push(s %%T) {
  st.st[st.sp] = s
  st.sp++
}
func (st *%%ST) Drop(n int) []%%T {
  st.sp -= n
  return st.st[st.sp : st.sp+n]
}
func (st *%%ST) Pop() %%T {
  st.sp--
  return st.st[st.sp]
}
func (st *%%ST) Dump() []%%T { return st.st[0:st.sp] }
func (st *%%ST) Depth() int { return st.sp }
func (st *%%ST) Index(p int) %%T { return st.st[st.sp-p] }
func New%%S(n int) *%%ST {
  r := new(%%ST)
  if n == 0 {
    r.limit = false
  } else {
    r.st = make([]%%T, n)
    r.limit = true
  }
  return r
}
